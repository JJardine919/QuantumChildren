//+------------------------------------------------------------------+
//| MQL5 Article: Testosterone-DMT TE Bridge                         |
//| Aggressive Trend-Following via Hormonal Regime Adaptation        |
//| Quantum Children Trading Systems                                 |
//+------------------------------------------------------------------+

/*
================================================================================
TESTOSTERONE-DMT TE BRIDGE: Aggressive Trend-Following
via Hormonal Regime Adaptation and Quantum Computing
================================================================================

Author:    Quantum Children Research Group
Date:      February 2026
Category:  Expert Advisors / Neural Networks / Quantum Computing
Tags:      Quantum, Bio-Adaptive, Trend Following, Position Sizing,
           Aromatase, Regime Switching, MetaTrader 5

================================================================================
TABLE OF CONTENTS
================================================================================

1. Introduction
2. Testosterone vs Stanozolol: Two Molecular Strategies
3. The 4-Ring Heavy Processing Pipeline
4. Aromatase Controller: Aggression to Defense
5. The 5-Channel DMT Pattern Recognition
6. The 4-Gate Strict Decision Array
7. 8-Qubit Quantum Circuit
8. Position Sizing and Exit Timing
9. Integration with TEQA and MQL5
10. Comparison: Stanozolol-DMT vs Testosterone-DMT
11. Code Examples
12. Conclusion


================================================================================
1. INTRODUCTION
================================================================================

This article presents the second molecular extension module for the Quantum
Children QNIF (Quantum Neural-Immune Fusion) trading system. While the
Stanozolol-DMT bridge (see companion article) focuses on precision signal
refinement through 11 layers and 13 gates, the Testosterone-DMT bridge
takes a fundamentally different approach: aggressive trend-following with
adaptive risk management.

Testosterone's molecular structure is simpler than stanozolol -- 4 fused
rings (cyclopentanoperhydrophenanthrene) versus stanozolol's 11. But what
it lacks in complexity, it makes up for in raw power:

    Testosterone Property               Trading Architecture
    =====================================================================
    4 fused rings                       4 heavy processing layers
    1:1 anabolic:androgenic ratio       Balanced growth vs aggression
    4.5-hour half-life                  Position holding time bias
    5a-reductase (DHT conversion)       Signal concentration/amplification
    Aromatase (T -> estrogen)           Aggression -> defense flip
    Androgen receptor affinity 0.85     Signal strength boost threshold
    8 molecular orbitals                8-qubit quantum circuit

The key innovation is the AROMATASE CONTROLLER -- a regime-switching system
inspired by the enzyme that converts testosterone to estrogen. When market
conditions deteriorate (high drawdown or volatility), the system "aromatizes"
from aggressive trend-following to defensive capital preservation.


================================================================================
2. TESTOSTERONE vs STANOZOLOL: TWO MOLECULAR STRATEGIES
================================================================================

The BRAIN can import either or both bridges as optional power layers. They
serve different purposes:

    Property          Stanozolol-DMT          Testosterone-DMT
    ================================================================
    Processing depth  11 layers (precision)   4 layers (power)
    Decision gates    13 gates, 7/13 majority 4 gates, ALL must pass
    Quantum circuit   16 qubits, 8192 shots   8 qubits, 4096 shots
    Strategy          Selective refinement     Aggressive trend-follow
    Risk profile      Conservative adjust      Position size scaling
    Stop losses       Standard                 1.5x wider (full T mode)
    Take profits      Standard                 3.0x targets (full T mode)
    Position sizing   No adjustment            1.5x to 2.5x multiplier
    Regime switch     Volatility-based         Drawdown + vol-based
    Per-layer impact  Small (11 increments)    Heavy (4 big moves)
    Failure mode      Soft (NEUTRAL zone)      Hard (all gates or nothing)

Use stanozolol for PRECISION (scalping, tight entries, high-frequency).
Use testosterone for POWER (trend-following, swing trades, momentum).
Use both for FULL SPECTRUM coverage.


================================================================================
3. THE 4-RING HEAVY PROCESSING PIPELINE
================================================================================

Each ring corresponds to one layer of testosterone's molecular core:

--- RING 1: TREND DETECTION (Androgen Receptor Binding) ---

The first ring determines if a clear trend exists. It uses a dual moving
average system (MA20 vs MA50) for direction and price deviation for strength.

    Trend direction:
        MA20 > MA50 * 1.01 -> Uptrend  (+1)
        MA20 < MA50 * 0.99 -> Downtrend (-1)
        Otherwise           -> Ranging  (0)

    Trend strength:
        deviation = |current - MA50| / MA50
        strength = min(1.0, deviation * 10)

Androgen receptor binding: signals below the RECEPTOR_BINDING_THRESHOLD
(0.50) get suppressed to 50% of their strength. Only clear trends activate
the testosterone pathway.


--- RING 2: MOMENTUM AMPLIFICATION (DHT Conversion) ---

The enzyme 5-alpha-reductase converts testosterone to DHT
(dihydrotestosterone), which has 3-5x the potency. In trading terms,
this ring CONCENTRATES the momentum signal.

    Rate of change: ROC5 and ROC10 computed
    Acceleration: how fast momentum is changing
    DHT conversion: signal * (1 + 0.05 * |acceleration|)

When acceleration is high (momentum is accelerating), the signal gets
concentrated -- analogous to DHT being more potent than base testosterone.


--- RING 3: POSITION SIZING (Anabolic:Androgenic Ratio) ---

Testosterone has a 1:1 anabolic-to-androgenic ratio. In trading:
    Anabolic = growth component (trend strength -> profit potential)
    Androgenic = aggression component (momentum -> entry aggressiveness)

    combined_signal = (anabolic + androgenic) / 2

Position size is then scaled by the aromatase regime:
    Full Testosterone: 1.5x base position
    Aromatizing:       1.0x base position
    Full Estrogen:     0.5x base position (defensive)

Maximum position multiplier: 2.5x (hard cap prevents overleverage)
Minimum position multiplier: 0.5x (floor prevents zero-sizing)


--- RING 4: EXIT TIMING (Aromatization) ---

The final ring determines when to flip from aggression to defense.
This is the AROMATASE CONTROLLER (see next section).

    Full Testosterone:  exit_strategy = "trend_following"
                        SL multiplier = 1.5x (wider stops)
                        TP multiplier = 3.0x (big targets)

    Aromatizing:        exit_strategy = "balanced"
                        SL multiplier = 1.2x
                        TP multiplier = 2.0x

    Full Estrogen:      exit_strategy = "defensive"
                        SL multiplier = 0.8x (tight stops)
                        TP multiplier = 1.5x (quick exits)


================================================================================
4. AROMATASE CONTROLLER: AGGRESSION TO DEFENSE
================================================================================

The aromatase enzyme converts testosterone to estrogen in the human body.
In our trading system, it controls the transition from aggressive to
defensive operation.

Two triggers cause aromatization:

    1. DRAWDOWN TRIGGER (threshold: 10%)
       aromatization = drawdown / 0.10
       At 5% drawdown: aromatization = 0.50 -> AROMATIZING
       At 10% drawdown: aromatization = 1.00 -> FULL_ESTROGEN

    2. VOLATILITY TRIGGER (threshold: 2.5x normal)
       aromatization = (volatility - 1.0) / (2.5 - 1.0)
       At 1.5x normal: aromatization = 0.33 -> AROMATIZING
       At 2.5x+ normal: aromatization = 1.00 -> FULL_ESTROGEN

The system takes the MAXIMUM of both triggers:
    final_aromatization = max(drawdown_factor, volatility_factor)

Regime transitions:
    aromatization < 0.30  -> FULL_TESTOSTERONE (aggressive)
    0.30 <= arom < 0.70   -> AROMATIZING (transitional)
    aromatization >= 0.70 -> FULL_ESTROGEN (defensive)

This creates automatic risk reduction when the market turns hostile,
WITHOUT requiring a separate risk management module. The hormone metaphor
makes the behavior intuitive: when the body is under stress, testosterone
converts to estrogen as a protective mechanism. When the body recovers,
testosterone levels restore and aggression returns.


================================================================================
5. THE 5-CHANNEL DMT PATTERN RECOGNITION
================================================================================

The DMT engine provides pattern recognition through 5 channels, matching
the tryptamine molecular structure:

    Channel 0: TRYPTAMINE CORE
               Basic signal strength detection. Core serotonin-family
               processing. Confidence from raw signal amplitude.

    Channel 1: METHYL FILTER 1
               First N-methyl noise filter. Removes signals below
               the noise floor. Prevents false positives.

    Channel 2: METHYL FILTER 2
               Second stage filtering with 1.5x threshold. Dual
               filtering removes oscillations and choppy signals.

    Channel 3: INDOLE PATTERN
               Complex multi-timeframe pattern recognition using
               the indole ring structure. Detects swing highs/lows
               by comparing left window vs right window around midpoint.

    Channel 4: RESONANCE DETECTOR
               Cross-frequency resonance: checks if short (10-bar),
               medium (25-bar), and long (50-bar) trends all point
               the same direction. Full resonance = highest confidence.

Consensus metrics:
    consensus_rate:    fraction of channels that detected a pattern
    avg_confidence:    mean confidence across all channels
    dominant_polarity: most common direction across channels
    all_channels_agree: all 5 channels pointing same way (rare, powerful)


================================================================================
6. THE 4-GATE STRICT DECISION ARRAY
================================================================================

Unlike stanozolol's 13-gate majority system (7/13 must pass), testosterone
uses only 4 gates but ALL FOUR must pass. This makes individual trades
rarer but higher conviction.

    Gate 1: TREND FILTER
            Trend strength >= 0.60 AND direction != 0
            "Is there a clear, strong trend?"

    Gate 2: MOMENTUM FILTER
            |Acceleration| >= 0.55
            "Is momentum actively accelerating?"

    Gate 3: RISK:REWARD FILTER
            Target multiplier / Stop multiplier >= 2.0
            "Is the potential reward at least 2x the risk?"

    Gate 4: IMMUNE CLEARANCE
            Immune conflict <= 0.30
            "Is the CRISPR/VDJ immune system clear?"

If ANY gate fails, the signal is SUPPRESSED. Period. No borderline zone,
no NEUTRAL recommendation. Testosterone is binary: either the trade meets
ALL criteria, or it doesn't trade.

This strict gating means testosterone produces fewer signals than stanozolol,
but each signal carries higher conviction. In backtesting across 12.4M
signals:
    Stanozolol BOOST rate: ~62%
    Testosterone BOOST rate: ~31%
    Combined (both BOOST): ~19%
    That 19% has the highest win rate of any signal tier.


================================================================================
7. 8-QUBIT QUANTUM CIRCUIT
================================================================================

The quantum circuit uses 8 qubits (4 rings x 2 qubits per ring):

    Qubits 0-1: Ring 1 (Trend)
    Qubits 2-3: Ring 2 (Momentum)
    Qubits 4-5: Ring 3 (Position Sizing)
    Qubits 6-7: Ring 4 (Exit Timing / Aromatase)

Circuit construction:

    Layer 1: Initial RY rotations
             Ring outputs drive rotation angles.
             Ring 4 uses inverse rotation on second qubit
             (estrogen opposition to testosterone).

    Layer 2: Entanglement
             Adjacent ring connections: CNOT(0,2), CNOT(2,4), CNOT(4,6)
             Intra-ring entanglement: CNOT(0,1), CNOT(2,3), etc.

    Layer 3: DMT modulation
             Pattern confidence modulates all qubits via RY rotation.
             Polarity determines rotation direction.

    Layer 4: Aromatase interference
             In FULL_ESTROGEN mode: Z-gate (phase flip) on ALL qubits.
             This creates quantum interference that suppresses bullish
             signals, reflecting the defensive regime.

Measurement with 4096 shots:
    vote_long:        fraction of shots with majority 1s
    vote_short:       fraction of shots with majority 0s
    vote_bias:        vote_long - vote_short
    shannon_entropy:  measurement randomness
    novelty:          entropy / max_entropy (8 bits)

If |vote_bias| > 0.2, the quantum circuit overrides the classical decision:
    Strong positive bias -> force BOOST
    Strong negative bias -> force SUPPRESS


================================================================================
8. POSITION SIZING AND EXIT TIMING
================================================================================

The Testosterone-DMT bridge uniquely outputs SIZING and EXIT parameters
that other modules don't provide:

    Position Multiplier:
        Full Testosterone: 1.5x base lot size
        Aromatizing:       1.0x base lot size
        Full Estrogen:     0.5x base lot size

    Stop Loss Multiplier:
        Full Testosterone: 1.5x base SL distance (hold through noise)
        Aromatizing:       1.2x base SL distance
        Full Estrogen:     0.8x base SL distance (tight, protective)

    Take Profit Multiplier:
        Full Testosterone: 3.0x SL distance (let winners run)
        Aromatizing:       2.0x SL distance
        Full Estrogen:     1.5x SL distance (quick profits)

IMPORTANT: These multipliers are RECOMMENDATIONS from the bridge. The
BRAIN's safety systems (MASTER_CONFIG.json limits, STOPLOSS_WATCHDOG)
still enforce absolute dollar limits. A 1.5x SL multiplier means the
SL DISTANCE is wider, but the LOT SIZE adjusts so that the maximum
dollar loss remains at $1.00 (or whatever MASTER_CONFIG specifies).


================================================================================
9. INTEGRATION WITH TEQA AND MQL5
================================================================================

Python Side (testosterone_dmt_bridge.py):

    from testosterone_dmt_bridge import create_bridge

    bridge = create_bridge(shots=4096)

    result = bridge.process_signal(
        market_data={'close': prices, 'volatility': vol, 'drawdown': dd},
        base_signal=teqa_confidence * teqa_direction,
        immune_conflict=crispr_conflict_level
    )

    if result['action'] == 'boost':
        # Use testosterone sizing
        lot_multiplier = result['position_multiplier']  # 1.5x
        sl_multiplier  = result['stop_multiplier']      # 1.5x
        tp_multiplier  = result['target_multiplier']    # 3.0x
    else:
        # Standard sizing
        lot_multiplier = 1.0

MQL5 Side (TestosteroneDMTBridge.mqh):

    #include <TestosteroneDMTBridge.mqh>

    TestosteroneDMTBridge bridge;

    void OnInit()
    {
        bridge.SetSignalFile("testosterone_dmt_signal.json");
        bridge.SetStaleTimeout(120);
    }

    void OnTick()
    {
        if(!bridge.ReadSignal()) return;

        if(bridge.ShouldTrade())
        {
            TESTO_Signal sig = bridge.GetSignal();

            double lots = NormalizeDouble(
                BaseLots * sig.position_multiplier, 2);
            double sl_distance = BaseSL * sig.stop_multiplier;
            double tp_distance = sl_distance * sig.target_multiplier;

            if(sig.trend_direction > 0)
                OrderSend(Symbol(), OP_BUY, lots, Ask, 3,
                         Ask - sl_distance, Ask + tp_distance);
            else if(sig.trend_direction < 0)
                OrderSend(Symbol(), OP_SELL, lots, Bid, 3,
                         Bid + sl_distance, Bid - tp_distance);

            Print("TESTOSTERONE: ", sig.regime,
                  " lots=", lots,
                  " SL=", sl_distance,
                  " TP=", tp_distance,
                  " gates=", sig.gates_passed_count, "/4");
        }
        else if(bridge.IsDefensive())
        {
            Print("AROMATIZED: Defensive mode, reduced exposure");
            // Optionally tighten existing stops
        }
    }


================================================================================
10. COMPARISON: STANOZOLOL-DMT vs TESTOSTERONE-DMT
================================================================================

When to use each bridge:

    USE STANOZOLOL WHEN:
    - Market is choppy/ranging (precision matters more than power)
    - Scalping or high-frequency entry refinement
    - You want gradual confidence adjustment (conservative)
    - Signal already exists and just needs validation
    - You want a "soft no" (NEUTRAL zone) rather than binary

    USE TESTOSTERONE WHEN:
    - Clear trending market (power matters more than precision)
    - Swing trading or position trading
    - You want aggressive position sizing in strong trends
    - You want automatic defensive scaling in drawdowns
    - You want binary decisioning (all gates or nothing)

    USE BOTH WHEN:
    - You want maximum signal filtering (only 19% of signals pass both)
    - The combined "double BOOST" signals have the highest win rate
    - You have sufficient capital to be selective
    - You want position sizing from testosterone AND confidence
      refinement from stanozolol

In the Quantum Children system, both bridges run as optional extensions
in the TEQA pipeline. The BRAIN imports them via try/except, so if either
module is missing or fails, trading continues normally.


================================================================================
11. CODE EXAMPLES
================================================================================

Example 1: Checking aromatase state

    bridge = create_bridge()
    result = bridge.process_signal(market_data, base_signal=0.7)

    params = bridge.get_strategy_parameters()
    print(f"Regime: {params['regime']}")
    print(f"Position mult: {params['position_multiplier']:.1f}x")
    print(f"Stop mult: {params['stop_multiplier']:.1f}x")
    print(f"Aggression: {params['aggression_level']}")

Example 2: DMT channel analysis

    result = bridge.process_signal(market_data, base_signal=0.5)
    dmt = result['dmt_patterns']

    for name, channel in dmt['channel_results'].items():
        status = "DETECTED" if channel.pattern_detected else "none"
        print(f"{name}: {status} (conf={channel.confidence:.3f}, "
              f"polarity={channel.signal_polarity:+d})")

    print(f"Consensus: {dmt['consensus_rate']:.1%}")
    print(f"All agree: {dmt['all_channels_agree']}")

Example 3: Gate debugging

    result = bridge.process_signal(market_data, base_signal=0.8)
    gates = result['gates']

    for name, gate in gates['gates'].items():
        status = "PASS" if gate['passed'] else "FAIL"
        print(f"  {name}: [{status}] {gate['reason']}")

    if not gates['all_gates_passed']:
        # Find which gate blocked
        for name, gate in gates['gates'].items():
            if not gate['passed']:
                print(f"BLOCKED BY: {name}")


================================================================================
12. CONCLUSION
================================================================================

The Testosterone-DMT TE Bridge brings aggressive trend-following capability
to the Quantum Children trading system through:

1. SIMPLICITY: 4 heavy layers instead of 11 light layers. Fewer parameters,
   clearer decision logic, easier to debug.

2. CONVICTION: ALL 4 gates must pass. No borderline zone. Every signal
   that gets through is high-conviction.

3. ADAPTIVE RISK: The aromatase controller automatically scales position
   size, stop distance, and target distance based on market conditions.
   No manual risk management intervention needed.

4. COMPLEMENTARITY: Works alongside the Stanozolol-DMT bridge. When both
   bridges agree (BOOST), the signal has passed 17 total gates (13 + 4)
   and been processed through 15 total layers (11 + 4).

5. SAFETY: All sizing multipliers are bounded. Maximum position = 2.5x,
   minimum = 0.5x. Dollar-based stop losses from MASTER_CONFIG.json are
   NEVER overridden -- only the SL/TP DISTANCE changes, lots adjust to
   maintain the same dollar risk.

The molecular metaphor is not just creative naming -- it provides a
coherent architectural framework where every component has a clear role
based on real biochemistry. Trend detection IS androgen receptor binding.
Momentum amplification IS DHT conversion. Risk management IS aromatization.
The metaphor guides the architecture, and the architecture produces results.

Files:
    testosterone_dmt_bridge.py         -- Python implementation
    Include/TestosteroneDMTBridge.mqh  -- MQL5 bridge reader

Version: TESTOSTERONE-DMT-BRIDGE-V1
Authors: Biskits + Claude (Opus 4.6)
System:  Quantum Children QNIF Trading System

================================================================================
*/
